from openai import OpenAI
import re
import httpx

client = OpenAI(
    api_key="YOUR API KEY",
    http_client=httpx.Client(proxy="YOUR PROXY")
)

def makeSlang(answer):
    replacements = {
    "you": "u",
    "hat about u": "bu",
    "y the way": "tw",
    "hat u doing": "yd",
    "et me know": "mk",
    "about": "ab",
    "+": "",
    "ight now": "n"
    }

    for old, new in replacements.items():
        answer = answer.replace(old, new)

    answer = answer.replace("\n ", "\n")
    return answer


def isEmoji(character):
    emoji_ranges = [
        (0x1F600, 0x1F64F),  # ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ ÑĞ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸
        (0x1F300, 0x1F5FF),  # Ğ Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ¸ Ğ¿Ğ¸ĞºÑ‚Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
        (0x1F680, 0x1F6FF),  # Ğ¡Ğ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¸ ĞºĞ°Ñ€Ñ‚Ñ‹
        (0x1F1E6, 0x1F1FF),  # Ğ¤Ğ»Ğ°Ğ³Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½ Ğ¼Ğ¸Ñ€Ğ°
    ]
    for emoji_range in emoji_ranges:
        if ord(character) in range(emoji_range[0], emoji_range[1] + 1):
            return True
    return False
def addNewlineAfterEmoji(text):
    new_text = ''
    for char in text:
        new_text += char
        if isEmoji(char):
            new_text += "\n"
    return new_text


def removeExtraChars(text):
    extra_chars = ['ğŸ›','ğŸ€','ğŸˆ','ğŸ’¬','âš½','ğŸ“¼','ğŸ“¸','ğŸ“¹','ğŸ¥','ğŸ“º','ğŸ“½','ï¸','ğŸ','ï¸','ğŸ–','ï¸','ğŸ¬','ğŸ‘“','ğŸ§','ğŸ¼','ğŸ¹','ğŸŒ‚','ğŸ¥½','ğŸ•¶','ï¸','ğŸ®','ğŸ’','ğŸ§³','ğŸ’¼','ğŸ©','ğŸ‘œ','ğŸª–','ğŸ‘’','ğŸ“','â›‘','ï¸','ğŸ‘','ğŸ‘‘','ğŸ™ƒ','ğŸ˜›','ğŸ§','ğŸ¤“','ğŸ¤ª','ğŸ˜–','ğŸ˜£','ğŸ˜Ÿ','ğŸ˜¤','ğŸ˜¡','ğŸ¤¬','ğŸ¤¯','ğŸ¤—','ğŸ˜ƒ','ğŸ˜„','ğŸ˜','ğŸ˜†','ğŸ˜€','ğŸ˜','ğŸ˜ ','ğŸ˜¶','â€','ğŸŒ«','ï¸','ğŸ˜±','ğŸ˜¨','ğŸ˜°','ğŸ˜¥','ğŸ˜“','ğŸ¤—','ğŸ¤”','ğŸ«¡','ğŸ¤«','ğŸ« ','ğŸ¤¥','ğŸ˜¶','ğŸ«¥','ğŸ˜¬','ğŸ«¨','ğŸ˜‘','ğŸ«¤','ğŸ˜','ğŸ˜¯','ğŸ˜¦','ğŸ˜§','ğŸ˜®','ğŸ˜ª','ğŸ˜®','â€','ğŸ’¨','ğŸ˜µ','ğŸ˜µ','â€','ğŸ’«','ğŸ¤','ğŸ¥´','ğŸ¤’','ğŸ˜·','ğŸ¤§','ğŸ¤®','ğŸ¤¢','ğŸ¤•','ğŸ¤‘','ğŸ¤ ','ğŸ‘»','ğŸ’©','ğŸ‘º','ğŸ‘¹','ğŸ‘¹','ğŸ’€','â˜ ','ï¸','ğŸ‘½','ğŸ‘¾','ğŸ¤–','ğŸƒ','ğŸ˜¾','ğŸ™€','ğŸ¤²','ğŸ‘','ğŸ™Œ','ğŸ¤','ğŸ‘Š','âœŠ','ğŸ¤›','ğŸ¤œ','ğŸ«·','ğŸ«¸','ğŸ«°','ğŸ¤Ÿ','ğŸ¤˜','ğŸ¤Œ','ğŸ»','ğŸ¤','ğŸ«³','ğŸ«´','ğŸ‘ˆ','ğŸ‘‰','ğŸ»','ğŸ‘†','ğŸ‘‡','â˜','ï¸','âœ‹','ğŸ¤š','ğŸ–','ï¸','ğŸ––','ğŸ‘‹','ğŸ¤™','ğŸ«²','ğŸ«±','ğŸ¦¾','ğŸ’ª','ğŸ–•','âœ','ï¸','ğŸ«µ','ğŸ¦¶','ğŸ¦µ','ğŸ¦¿','ğŸ’„','ğŸ«¦','ğŸ‘„','ğŸ¦·','ğŸ‘…','ğŸ‘‚','ğŸ¦»','ğŸ‘ƒ','ğŸ‘£','ğŸ‘','ï¸','ğŸ«€','ğŸ«','ğŸ—£','ï¸','ğŸ‘¤','ğŸ‘¥','ğŸ«‚','ğŸª¢','ğŸ§¶','ğŸ§µ','ğŸª¡','ğŸ‘•','ğŸ‘š','ğŸ¦º','ğŸ¥¼','ğŸ§¥','ğŸ‘–','ğŸ©²','ğŸ©³','ğŸ‘”','ğŸ‘—','ğŸ©´','ğŸ¥»','ğŸ‘˜','ğŸ©±','ğŸ‘™','ğŸ¥¿','ğŸ‘ ','ğŸ‘¡','ğŸ‘¢','ğŸ‘','ğŸ§£','ğŸ§¤','ğŸ§¦','ğŸ¥¾','ğŸ‘Ÿ','ğŸ©','ğŸ§¢','ğŸ‘’','ğŸ“','â›‘','ï¸','ğŸ‘›','ğŸ‘','ğŸ’','ğŸ‘‘','ğŸª–','ğŸ‘œ','ğŸ’¼','ğŸ’','ğŸ§³','ğŸ‘“','ğŸ¥½','ğŸ•¶','ï¸','ğŸŒ‚','ğŸ±','ğŸ¶','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ»','â€','â„','ï¸','ğŸ¨','ğŸ¯','ğŸ¦','ğŸ®','ğŸ·','ğŸ½','ğŸ¸','ğŸ’','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¦','â€','â¬›','ğŸ¦†','ğŸª¿','ğŸ¥','ğŸ£','ğŸ¦…','ğŸ¦‰','ğŸ¦‡','ğŸº','ğŸ—','ğŸª±','ğŸ«','ğŸ','ğŸ¦„','ğŸ´','ğŸ›','ğŸŒ','ğŸ','ğŸœ','ğŸ¦—','ğŸ¦Ÿ','ğŸª³','ğŸª²','ğŸª°','ğŸ•·','ï¸','ğŸ•¸','ï¸','ğŸ¦‚','ğŸ¢','ğŸ','ğŸ¦‘','ğŸ™','ğŸ¦•','ğŸ¦–','ğŸ¦','ğŸª¼','ğŸ¦','ğŸ¦','ğŸ¦€','ğŸ¡','ğŸ‹','ğŸ³','ğŸ¬','ğŸŸ','ğŸ ','ğŸ¦ˆ','ğŸ¦­','ğŸŠ','ğŸ…','ğŸ†','ğŸ˜','ğŸ¦£','ğŸ¦§','ğŸ¦','ğŸ¦“','ğŸ¦›','ğŸ¦','ğŸª','ğŸ«','ğŸ¦’','ğŸ„','ğŸ‚','ğŸƒ','ğŸ¦¬','ğŸ¦˜','ğŸ«','ğŸ','ğŸ–','ğŸ','ğŸ‘','ğŸ©','ğŸ¦Œ','ğŸ•','ğŸ','ğŸ¦™','ğŸ¦®','ğŸ•','â€','ğŸ¦º','ğŸˆ','ğŸˆ','â€','â¬›','ğŸª¶','ğŸ¦š','ğŸ¦¤','ğŸ¦ƒ','ğŸ“','ğŸª½','ğŸ¦œ','ğŸ¦¢','ğŸ¦©','ğŸ•Š','ï¸','ğŸ‡','ğŸ¦¦','ğŸ¦«','ğŸ¦¡','ğŸ¦¨','ğŸ¦','ğŸ¦¥','ğŸ','ğŸ€','ğŸ¿','ï¸','ğŸ¦”','ğŸ„','ğŸŒµ','ğŸ²','ğŸ‰','ğŸ¾','ğŸŒ²','ğŸŒ³','ğŸŒ´','ğŸªµ','ğŸŒ±','ğŸª´','ğŸ','ğŸ€','â˜˜','ï¸','ğŸŒ¿','ğŸ‹','ğŸƒ','ğŸ‚','ğŸ','ğŸªº','ğŸª¨','ğŸª¸','ğŸš','ğŸ„','ğŸª¹','ğŸŒ¾','ğŸ’','ğŸŒ·','ğŸŒ¹','ğŸ¥€','ğŸŒ¼','ğŸŒ¸','ğŸŒº','ğŸª·','ğŸª»','ğŸŒ»','ğŸŒ™','ğŸ’«','âš¡','ï¸','âœ¨','ğŸŒŸ','â­','ï¸','â˜„','ï¸','â˜€','ï¸','ğŸŒˆ','ğŸŒª','ï¸','ğŸ’¥','ğŸŒ¤','ï¸','â›…','ï¸','ğŸŒ¥','ï¸','â˜','ï¸','ğŸŒ¦','ï¸','ğŸŒ§','ï¸','â›ˆ','ï¸','ğŸŒ©','ï¸','ğŸŒ¨','ï¸','â„','ï¸','ğŸ’¨','ğŸŒ¬','ï¸','â›„','ï¸','â˜ƒ','ï¸','ğŸ«§','â˜”','ï¸','â˜‚','ï¸','ğŸ’§','ğŸŒŠ','ğŸ«§','ğŸŒ«','ï¸','ğŸ¿','ğŸ™','ğŸ‚','ğŸº','ğŸ¥ƒ','ğŸ¥£','ğŸ¤¿','ğŸ¥…','ğŸ£','ğŸªƒ','ğŸ¹','ğŸ›','ğŸª','ğŸ¥‹','â›¸','ï¸','ğŸ½','ğŸ¥Œ','ğŸ›¼','ğŸ›·','ğŸŸ','ï¸','ğŸµ','ï¸','ğŸ—','ï¸','ğŸ«','ğŸ¤¹','ğŸ½','â€','â™‚','ï¸','ğŸ¤¹','â€','â™‚','ï¸','ğŸ¤¹','â€','â™€','ï¸','ğŸª','ğŸ¤','ğŸ¬','ğŸ¨','ğŸ­','ğŸ©°','ğŸ§','ğŸ¼','ğŸ¹','ğŸª‡','ğŸ¥','ğŸ¸','ğŸª—','ğŸº','ğŸ·','ğŸª˜','ğŸª•','ğŸ»','ğŸªˆ','ğŸ²','â™Ÿ','ï¸','ğŸ§©','ğŸ°','ğŸ®','ğŸ³','ğŸ¯','ğŸš—','ğŸš•','ğŸš™','ğŸšŒ','ğŸš','ğŸš','ğŸš’','ğŸš‘','ğŸš“','ğŸ','ï¸','ğŸ›»','ğŸšš','ğŸš›','ğŸšœ','ğŸ¦¯','ğŸš²','ğŸ›´','ğŸ©¼','ğŸ¦¼','ğŸ¦½','ğŸ›µ','ğŸ','ï¸','ğŸ›º','ğŸ›','ğŸš¨','ğŸš¡','ğŸš–','ğŸš˜','ğŸš','ğŸš”','ğŸš ','ğŸšŸ','ğŸšƒ','ğŸš‹','ğŸš','ğŸš‚','ğŸšˆ','ğŸš…','ğŸš„','ğŸš','ğŸš†','ğŸš‡','ğŸšŠ','ğŸš‰','âœˆ','ï¸','ğŸ›°','ï¸','ğŸ’º','ğŸ›©','ï¸','ğŸ›¬','ğŸ›«','ğŸš€','ğŸ›¸','ğŸš','ğŸ›¶','â›µ','ï¸','ğŸš¢','â›´','ï¸','ğŸ›³','ï¸','ğŸ›¥','ï¸','ğŸš¤','ğŸ›Ÿ','âš“','ï¸','ğŸª','â›½','ï¸','â›½','ï¸','ğŸ—¿','ğŸ—º','ï¸','ğŸš','ğŸš¥','ğŸš¦','ğŸ—½','ğŸ—¼','ğŸ°','ğŸ¯','ğŸŸ','ï¸','â›±','ï¸','â›²','ï¸','ğŸ ','ğŸ¢','ğŸ¡','ğŸ–','ï¸','ğŸ','ï¸','ğŸœ','ï¸','ğŸŒ‹','â›°','ï¸','ğŸ›–','â›º','ï¸','ğŸ•','ï¸','ğŸ—»','ğŸ”','ï¸','ğŸ ','ğŸ¡','ğŸ˜','ï¸','ğŸš','ï¸','ğŸ—','ï¸','ğŸ¤','ğŸ£','ğŸ¬','ğŸ¢','ğŸ­','ğŸ¥','ğŸ¦','ğŸ¨','ğŸª','ğŸ«','ğŸ•Œ','â›ª','ï¸','ğŸ›','ï¸','ğŸ’’','ğŸ©','ğŸ•','ğŸ›•','ğŸ•‹','â›©','ï¸','ğŸ›¤','ï¸','ğŸŒ…','ğŸ','ï¸','ğŸ‘','ğŸ—¾','ğŸ›£','ï¸','ğŸŒ„','ğŸŒ ','ğŸ‡','ğŸ†','ğŸŒ‡','ğŸŒ‰','ğŸŒŒ','ğŸŒƒ','ğŸ™','ï¸','ğŸŒ†','ğŸŒ','âŒš','ï¸','ğŸ“±','ğŸ“²','ğŸ’»','âŒ¨','ï¸','ğŸ•¹','ï¸','ğŸ–²','ï¸','ğŸ–±','ï¸','ğŸ–¨','ï¸','ğŸ–¥','ï¸','ğŸ—œ','ï¸','ğŸ’½','ğŸ’¾','ğŸ’¿','ğŸ“€','ğŸ¥','ğŸ“¹','ğŸ“¸','ğŸ“·','ğŸ“¼','ğŸ“½','ï¸','ğŸ','ï¸','ğŸ“','â˜','ï¸','ğŸ“Ÿ','ğŸš','ï¸','ğŸ™','ï¸','ğŸ“»','ğŸ“º','ğŸ“ ','ğŸ›','ï¸','ğŸ§­','â±','ï¸','â²','ï¸','â°','ğŸ”‹','ğŸ“¡','â³','âŒ›','ï¸','ğŸ•°','ï¸','ğŸª«','ğŸ”Œ','ğŸ’¡','ğŸ”¦','ğŸ•¯','ï¸','ğŸª™','ğŸ›¢','ï¸','ğŸ§¯','ğŸª”','ğŸ’³','ğŸªª','ğŸ’','âš–','ï¸','ğŸªœ','âš’','ï¸','ğŸ”¨','ğŸª›','ğŸª›','ğŸ§°','ğŸ› ','ï¸','â›','ï¸','ğŸ”©','âš™','ï¸','ğŸ”«','ğŸ§²','â›“','ï¸','ğŸ§±','ğŸª¤','ğŸ—¡','ï¸','ğŸ—¡','ï¸','ğŸª“','ğŸ§¨','ğŸ’£','âš”','ï¸','ğŸ›¡','ï¸','ğŸš¬','âš°','ï¸','ğŸª¦','ğŸ§¿','ğŸ“¿','ğŸ”¬','ğŸ”­','âš—','ï¸','ğŸº','ğŸ’ˆ','âš±','ï¸','ğŸª¬','ğŸ–¼']
    for char in extra_chars:
        text = text.replace(char, '')
    return text

def replaceAny(prompt, name, modelInfo, setting, sourceOfAdds, age, city, link, ctaInfo, platform):
    replacements = {
    "[name]": name,
    "[model info]": modelInfo,
    "[setting]": setting,
    "[source of adds]": sourceOfAdds,
    "[age]": age,
    "[city]": city,
    "[link]": link,
    "[cta info]": ctaInfo,
    "[Platform]": platform
}
    

    for placeholder in replacements:
        prompt = prompt.replace(placeholder, replacements[placeholder])

    return prompt


def getPhoto(snapchatMessages):
    prompt = """Imagine you only know how to say two phrases. If the query is about sending a photo, return the answer: !photo, otherwise "I don't know."
    Your answer MUST CONTAIN ONLY !photo OR "I don't know." Don't forget your message history.
    If a user asks something about your appearance, you send a photo too.
    If they ask you questions but ask for a picture at the end, send a picture.
    If they ask you about sending any photo, return the answer: !photo.
    IF A USER HINTS, MENTIONS SENDING A PHOTO, SEND HIM: !photo.
    SNAP MEANS PHOTO TOO.
    You should only respond !photo when directly asked for a photo, not in other contexts like someone mentioning they will go photograph the forest.
    Respond with "I don't know" when asked to evaluate a photo, look at a photo, or interact with a photo in any other way except sending it.
    """
    messages = [{"role": "system", "content" : prompt}]
    messages += snapchatMessages

    complet = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=messages,
        temperature=0.8
    )


    ans = complet.choices[0].message.content

    return ans

def getAnswer(message, name, modelInfo, setting, sourceOfAdds, age, city, link, ctaInfo, platform):
    prompt = '''
    YOUR PROMPT
    '''
    prompt = replaceAny(prompt, name, modelInfo, setting, sourceOfAdds, age, city, link, ctaInfo, platform)
    
    messages = [{"role" : "system" , "content": prompt}]
    for i in message:
        i["content"] = i["content"].replace("*BotPhoto*", "")
        
    messages += message
    keywords = ["send", "share" ,"photo", "snap", "pic", "picture", "look", "one", "more"]
    includingKeywords = any(keyword in message[-1]["content"].lower() for keyword in keywords)

    if includingKeywords:
        answer = getPhoto(message[-3:])
        if "photo" in answer:
            return "!photo"
    res = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=messages,
        temperature=0.8
    ) 
    answer = res.choices[0].message.content
    answer = addNewlineAfterEmoji(answer)
    if "Heyy" in answer:
        return "Hey\nhow r u?"
    elif "without sharing photos" in answer.lower():
        return "!photo"
    answer = answer.replace('. ', "\n").replace("! ","\n").replace("? ","?\n").replace("'","")
    if answer[-1] == ".":
        answer = answer[:-1]
    answer = makeSlang(answer)
    return removeExtraChars(answer).lower()
    